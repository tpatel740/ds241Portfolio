---
title: "Covid Population Data Join Exercise"
author: "Tarak Patel"
output:
  html_document:
    df_print: paged
---
## Introduction

Countries around the world are responding to an outbreak of respiratory illness caused by a novel coronavirus, COVID-19. The outbreak first started in Wuhan, China, but cases have been identified in a growing number of other locations internationally, including the United States. In this report we explore how the trajectory of the cumulative deaths in a number of countries.

This file breaks down covid 19 deaths and filters data based on states.

## Installing packages
```{r load-packages, warning=FALSE, message=FALSE}
#library(coronavirus) # devtools::install_github("RamiKrispin/coronavirus")
library(tidyverse)
library(lubridate)
library(glue)
library(scales)
library(ggrepel)
library(DT)
library(readxl)
US_covid_data <- read_excel("United_States_COVID-19_Cases_and_Deaths_by_State_over_Time.xlsx")
View(US_covid_data)
```
```{r}
states <- c(
  "NY",
  "FL",
  "CT",
  "MA",
  "NJ",
  "TX",
  "CA",
  "WA",
  "IL",
  "ID"
)


covid <- US_covid_data %>%
  # filter for deaths in states of interest
  filter(
    #type == "tot_death",
    state %in% states
  ) %>%
  # calculate number of total cases for each country and date
  group_by(state, submission_date) %>%
  summarise(tot_cases = sum(tot_cases)) %>%
   #arrange by date in ascending order
  arrange(submission_date) %>%
   #record daily cumulative cases as cumulative_cases
  mutate(cumulative_cases = cumsum(tot_cases)) %>%
  # only use days since the 10th confirmed death
  #filter(cumulative_cases > 9) %>%
  # record days elapsed, end date, and end label
  mutate(
    days_elapsed = as.numeric(submission_date - min(submission_date)),
    end_date     = if_else(submission_date == max(submission_date), TRUE, FALSE),
    end_label    = if_else(end_date, state, NULL)
  ) %>%
  # ungroup
  ungroup()
```

#visualization
```{r visualise, warning=FALSE}
ggplot(data = covid,
       mapping = aes(x = submission_date, 
                     y = tot_cases, 
                     color = state)
                     ) +
  # represent cumulative cases with lines
  geom_line(size = 0.7, alpha = 0.8) +
  # add points to line endings
  geom_point(data = covid)  +
  # add country labels, nudged above the lines
  geom_label_repel(nudge_y = 1, direction = "y", hjust = 1, label = "state") + 
  # turn off legend
  guides(color = FALSE) +
  # use pretty colors
  scale_color_viridis_d() +
  # better formatting for y-axis
  scale_y_continuous(labels = label_comma()) +
  # use minimal theme
  theme_minimal() +
  theme(legend.position="right") +
  # customize labels
  labs(
    x = "Date",
    y = "Number of Deaths",
    title = "Cumulative deaths from COVID-19, selected states",
  )
```

Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.
